(function(){"use strict";function m(t){return t.filter(o=>o.is_audio_only?!0:!(!o.has_audio&&o.ext==="webm"))}function b(t){const o=t.filter(a=>!a.is_audio_only&&!a.has_audio),e=t.filter(a=>a.is_audio_only).sort((a,i)=>(i.bitrate??0)-(a.bitrate??0))[0];return e?o.map(a=>{var i,u,l,s;return{label:a.quality,videoUrl:a.url,audioUrl:e.url,videoCodec:(i=a.codec_label)!=null&&i.toLowerCase().includes("264")?"h264":(u=a.codec_label)!=null&&u.toLowerCase().includes("265")?"h265":void 0,audioCodec:(l=e.codec_label)!=null&&l.toLowerCase().includes("aac")?"aac":(s=e.codec_label)!=null&&s.toLowerCase().includes("opus")?"opus":void 0}}):[]}function v(t,o,d){const e=new URLSearchParams({video_url:o.videoUrl,audio_url:o.audioUrl,title:d});return o.videoCodec&&e.set("video_codec",o.videoCodec),o.audioCodec&&e.set("audio_codec",o.audioCodec),`${t}/api/stream/muxed?${e}`}const C="https://your-domain.com",r=document.getElementById("app");function c(t){r.innerHTML=t}function n(){return'<div class="header">â–¶ YouTube Downloader</div>'}async function f(){c(`${n()}<p class="status">Detecting YouTube tab...</p>`);const[t]=await chrome.tabs.query({active:!0,currentWindow:!0}),o=(t==null?void 0:t.url)??"";if(!(t!=null&&t.id)||!(o.includes("youtube.com/watch")||o.includes("youtu.be/"))){c(`${n()}<p class="status">Open a YouTube video to download.</p>`);return}c(`${n()}<p class="status">Extracting streams...</p>`),chrome.runtime.sendMessage({type:"EXTRACT",url:o},d=>{if(chrome.runtime.lastError||!d||d.error){c(`${n()}<p class="error">${(d==null?void 0:d.error)??"Extraction failed"}</p>`);return}const e=m(d.formats??[]),a=b(e),i=d.title??"video";if(a.length===0){c(`${n()}<p class="status">No downloadable streams found.</p>`);return}p(a,i)})}function p(t,o){const d=t.map(e=>`
      <li>
        <button data-video="${encodeURIComponent(e.videoUrl)}"
                data-audio="${encodeURIComponent(e.audioUrl)}"
                data-label="${encodeURIComponent(e.label)}"
                data-vcodec="${e.videoCodec??""}"
                data-acodec="${e.audioCodec??""}">
          <span>${e.label}</span>
          <span class="badge">${(e.videoCodec??"mp4").toUpperCase()}</span>
        </button>
      </li>`).join("");c(`${n()}<ul class="stream-list">${d}</ul>`),r.querySelectorAll(".stream-list button").forEach(e=>{e.addEventListener("click",()=>{const a={label:decodeURIComponent(e.dataset.label??""),videoUrl:decodeURIComponent(e.dataset.video??""),audioUrl:decodeURIComponent(e.dataset.audio??""),videoCodec:e.dataset.vcodec||void 0,audioCodec:e.dataset.acodec||void 0},i=v(C,a,o),u=`${o} [${a.label}].mp4`;chrome.runtime.sendMessage({type:"DOWNLOAD",url:i,filename:u}),window.close()})})}f()})();
